' Gambas class file


Public Sub Form_Open()

  repo_check()
  initialize()

End

Sub initialize()
  
  app_check("dnsminder", LaunchDNSMinderButton, InstallDNSMinderButton, UninstallDNSMinderButton)
  app_check("hostminder", LaunchHostMinderButton, InstallHostMinderButton, UninstallHostMinderButton)
  app_check("ubuntu-ce-parental-controls", LaunchParentalControlsButton, InstallParentalControlsButton, UninstallParentalControlsButton)
  app_check("timekpr-next", LaunchTimekprButton, InstallTimekprButton, UninstallTimekprButton)
  app_check("xiphos", LaunchXiphosButton, InstallXiphosButton, UninstallXiphosButton)
  app_check("bibletime", LaunchBibleTimeButton, InstallBibleTimeButton, UninstallBibleTimeButton)
  app_check("bibledit", LaunchBibleditButton, InstallBibleditButton, UninstallBibleditButton)
  app_check("bible-kjv", LaunchBibleKJVButton, InstallBibleKJVButton, UninstallBibleKJVButton) 
  app_check("bolls", LaunchBollsButton, InstallBollsBibleButton, UninstallBollsButton, True)
  app_check("dab-player", LaunchDabPlayerButton, InstallDabPlayerButton, UninstallDabPlayerButton, True)  
  app_check("bible-multi-the-life", LaunchBibleMTFButton, InstallBibleMTFButton, UninstallBibleMTFButton, True) 
  app_check("bible-multi-the-son-of-man", LaunchBibleSOMButton, InstallBibleSOMButton, UninstallBibleSOMButton, True) 
  app_check("presenter-by-worship-tools", LaunchPresenterButton, InstallPresenterButton, UninstallPresenterButton)
  app_check("freeshow", LaunchFreeShowButton, InstallFreeShowButton, UninstallFreeShowButton)
  app_check("io.gitlab.floodlight.Presenter", LaunchFloodlightButton, InstallFloodlightButton, UninstallFloodlightButton, False, True)
  ' app_check("quelea", LaunchQueleaButton, InstallQueleaButton, UninstallQueleaButton, True) 
  app_check("bibref", LaunchBibrefButton, InstallBibrefButton, UninstallBibrefButton, True)
  app_check("accountable2you", LaunchAccountable2youButton, InstallAccountable2youButton, UninstallAccountable2youButton, True)
  
End


Sub repo_check()
    
  If Not Exist("/etc/apt/sources.list.d/ubuntuce-jammy.list") Then
    If Message.Warning("The UbuntuCE Repo is not installed. \n\n It is required! \n\n Would you like to install it now?", "Install Now", "Cancel") = 1 Then 
      Exec ["gnome-terminal", "--", "bash", "-c", "wget https://job.ubuntuce.com/KEY.gpg -O KEY.gpg && gpg --output ubuntuce.gpg --dearmor KEY.gpg && sudo mv ubuntuce.gpg /usr/share/keyrings/ && rm KEY.gpg && sudo apt install curl -y && sudo curl -s --compressed -o /etc/apt/sources.list.d/ubuntuce-jammy.list 'https://job.ubuntuce.com/ubuntuce-jammy.list' && sudo apt update"]
      initialize()
    Else 
      Quit
    Endif
  Endif
  
End

Sub app_check(appName As String, launchButton As Button, installButton As Button, uninstallButton As Button, Optional isSnapd As Boolean = False, Optional isFlatpak As Boolean = False)
  
  Dim Result As String
  
  If isSnapd Then 
    Shell ("snap list | grep " & appName & " | awk '{print $1}'") To Result
    
    If InStr(Result, appName) = 0 Then 
      launchButton.Hide
      installButton.Show
      uninstallButton.Hide
    Else 
      launchButton.Show
      installButton.Hide
      uninstallButton.Show
    Endif
  Else If isFlatpak Then 
     Shell ("flatpak list | grep " & appName & " | awk '{print $3}'") To Result
    
    If InStr(Result, appName) = 0 Then 
      launchButton.Hide
      installButton.Show
      uninstallButton.Hide
    Else 
      launchButton.Show
      installButton.Hide
      uninstallButton.Show
    Endif
  Else 
    Shell ("apt-cache policy " & appName & " | grep 'none' | awk '{print $2}'") To Result
    
    If InStr(Result, "(none)") = 1 Then 
      launchButton.Hide
      installButton.Show
      uninstallButton.Hide
    Else 
      launchButton.Show
      installButton.Hide
      uninstallButton.Show
    Endif
  Endif

  
  
End

Sub install_app(appName As String, installProgressBar As ProgressBar, launchButton As Button, installButton As Button, uninstallButton As Button, Optional isSnapd As Boolean = False, Optional isFlatpak As Boolean = False)

  Dim InstallProcess As Process
  
  If Message.Question("Are you sure?") = 1 Then 
    If isSnapd Then 
      InstallProcess = TerminalView.Shell("pkexec snap install " & appName)
    Else If isFlatpak Then 
      InstallProcess = TerminalView.Shell("pkexec flatpak install flathub " & appName & " -y")
    Else 
      InstallProcess = TerminalView.Shell("pkexec apt install " & appName & " -y")
    Endif
    
    BlockPanel.Show
    BlockPanel.Top = 14
    TerminalView.Clear
    installProgressBar.Show
    installButton.Hide
    ExitButton.Enabled = False
    Do
      Try Wait 0.5    
    Loop Until InstallProcess.State = 0
  
    launchButton.Show
    uninstallButton.Show
    installButton.Hide
    installProgressBar.Hide
    BlockPanel.Hide
    ExitButton.Enabled = True
    
    InstallProcess = Null
    
    app_check(appName, launchButton, installButton, uninstallButton, isSnapd, isFlatpak)
      
  Endif
  
End

Sub uninstall_app(appName As String, installProgressBar As ProgressBar, launchButton As Button, installButton As Button, uninstallButton As Button, Optional isSnapd As Boolean = False, Optional isFlatpak As Boolean = False)

  Dim UninstallProcess As Process
  
  If Message.Question("Are you sure?") = 1 Then 
    If isSnapd Then 
      UninstallProcess = TerminalView.Shell("pkexec snap remove " & appName)
     Else If isFlatpak Then 
      UninstallProcess = TerminalView.Shell("pkexec flatpak remove " & appName)
    Else 
      UninstallProcess = TerminalView.Shell("pkexec apt autoremove " & appName & " -y")
    Endif
    
    BlockPanel.Show
    BlockPanel.Top = 14
    TerminalView.Clear
    installProgressBar.Show
    uninstallButton.Hide
    launchButton.Hide
    ExitButton.Enabled = False
    Do
      Try Wait 0.5    
    Loop Until UninstallProcess.State = 0
  
    launchButton.Hide
    installButton.Show
    uninstallButton.Hide
    installProgressBar.Hide
    BlockPanel.Hide
    ExitButton.Enabled = True
    
    UninstallProcess = Null
    
    app_check(appName, launchButton, installButton, uninstallButton, isSnapd, isFlatpak)
      
  Endif
  
End


Sub launch_app(appName As String, Optional isTerminal As Boolean = False, Optional isFlatpak As Boolean = False, Optional isSudo As Boolean = False)
  
  If isTerminal Then 
    Exec ["gnome-terminal", "--", "bash", "-c", appName]
  Else If isFlatpak Then 
    Exec ["flatpak", "run", appName]
  Else 
    If isSudo Then 
      Shell (appName)
    Else 
      Exec [appName]
    Endif
  Endif
  
End


Public Sub LaunchDNSMinderButton_Click()

  launch_app("dnsminder")

End

Public Sub InstallDNSMinderButton_Click()

  install_app("dnsminder", DNSMinderProgressBar, LaunchDNSMinderButton, InstallDNSMinderButton, UninstallDNSMinderButton)

End

Public Sub UninstallDNSMinderButton_Click()

  uninstall_app("dnsminder", DNSMinderProgressBar, LaunchDNSMinderButton, InstallDNSMinderButton, UninstallDNSMinderButton)

End

Public Sub LaunchHostMinderButton_Click()

  launch_app("hostminder")

End

Public Sub InstallHostMinderButton_Click()

  install_app("hostminder", HostMinderProgressBar, LaunchHostMinderButton, InstallHostMinderButton, UninstallHostMinderButton)

End

Public Sub UninstallHostMinderButton_Click()

  uninstall_app("hostminder", HostMinderProgressBar, LaunchHostMinderButton, InstallHostMinderButton, UninstallHostMinderButton)

End

Public Sub LaunchParentalControlsButton_Click()

  launch_app("malcontent-control")

End

Public Sub InstallParentalControlsButton_Click()

  install_app("ubuntu-ce-parental-controls", ParentalControlsProgressBar, LaunchParentalControlsButton, InstallParentalControlsButton, UninstallParentalControlsButton)

End

Public Sub UninstallParentalControlsButton_Click()

  uninstall_app("ubuntu-ce-parental-controls", ParentalControlsProgressBar, LaunchParentalControlsButton, InstallParentalControlsButton, UninstallParentalControlsButton)

End

Public Sub LaunchTimekprButton_Click()

  launch_app("pkexec /usr/bin/timekpra", False, False, True)

End

Public Sub InstallTimekprButton_Click()

  install_app("timekpr-next", TimekprProgressBar, LaunchTimekprButton, InstallTimekprButton, UninstallTimekprButton)

End

Public Sub UninstallTimekprButton_Click()

  uninstall_app("timekpr-next", TimekprProgressBar, LaunchTimekprButton, InstallTimekprButton, UninstallTimekprButton)

End

Public Sub LaunchXiphosButton_Click()

  launch_app("xiphos")

End

Public Sub InstallXiphosButton_Click()

  install_app("xiphos sword-text-web sword-text-kjv", XiphosProgressBar, LaunchXiphosButton, InstallXiphosButton, UninstallXiphosButton)

End

Public Sub UninstallXiphosButton_Click()

  uninstall_app("xiphos", XiphosProgressBar, LaunchXiphosButton, InstallXiphosButton, UninstallXiphosButton)

End

Public Sub LaunchBibleTimeButton_Click()

  launch_app("bibletime")

End

Public Sub InstallBibleTimeButton_Click()

  install_app("bibletime sword-text-web sword-text-kjv", BibleditProgressBar, LaunchBibleTimeButton, InstallBibleTimeButton, UninstallBibleTimeButton)

End

Public Sub UninstallBibleTimeButton_Click()

  uninstall_app("bibletime", BibleditProgressBar, LaunchBibleTimeButton, InstallBibleTimeButton, UninstallBibleTimeButton)

End

Public Sub LaunchBibleditButton_Click()

  launch_app("bibledit")

End

Public Sub InstallBibleditButton_Click()

  install_app("bibledit", BibleditProgressBar, LaunchBibleditButton, InstallBibleditButton, UninstallBibleditButton)

End

Public Sub UninstallBibleditButton_Click()

  uninstall_app("bibledit", BibleditProgressBar, LaunchBibleditButton, InstallBibleditButton, UninstallBibleditButton)

End

Public Sub LaunchBibleKJVButton_Click()

  launch_app("bible", True)

End

Public Sub InstallBibleKJVButton_Click()

  install_app("bible-kjv", BibleKJVProgressBar, LaunchBibleKJVButton, InstallBibleKJVButton, UninstallBibleKJVButton)

End

Public Sub UninstallBibleKJVButton_Click()

  uninstall_app("bible-kjv", BibleKJVProgressBar, LaunchBibleKJVButton, InstallBibleKJVButton, UninstallBibleKJVButton)

End

Public Sub LaunchBollsButton_Click()

  launch_app("bolls")

End

Public Sub InstallBollsBibleButton_Click()

  install_app("bolls", BollsProgressBar, LaunchBollsButton, InstallBollsBibleButton, UninstallBollsButton, True)

End

Public Sub UninstallBollsButton_Click()

  uninstall_app("bolls", BollsProgressBar, LaunchBollsButton, InstallBollsBibleButton, UninstallBollsButton, True)

End

Public Sub LaunchDabPlayerButton_Click()

  launch_app("dab-player")

End

Public Sub InstallDabPlayerButton_Click()

  install_app("dab-player", DabPlayerProgressBar, LaunchDabPlayerButton, InstallDabPlayerButton, UninstallDabPlayerButton, True)

End

Public Sub UninstallDabPlayerButton_Click()

  uninstall_app("dab-player", DabPlayerProgressBar, LaunchDabPlayerButton, InstallDabPlayerButton, UninstallDabPlayerButton, True)

End

Public Sub LaunchBibleMTFButton_Click()

  launch_app("bible-multi-the-life")

End

Public Sub InstallBibleMTFButton_Click()

  install_app("bible-multi-the-life", BibleMTFProgressBar, LaunchBibleMTFButton, InstallBibleMTFButton, UninstallBibleMTFButton, True)

End

Public Sub UninstallBibleMTFButton_Click()

  uninstall_app("bible-multi-the-life", BibleMTFProgressBar, LaunchBibleMTFButton, InstallBibleMTFButton, UninstallBibleMTFButton, True)

End

Public Sub LaunchBibleSOMButton_Click()

  launch_app("bible-multi-the-son-of-man", True)

End

Public Sub InstallBibleSOMButton_Click()

  install_app("bible-multi-the-son-of-man", BibleSOMProgressBar, LaunchBibleSOMButton, InstallBibleSOMButton, UninstallBibleSOMButton, True)

End

Public Sub UninstallBibleSOMButton_Click()

  uninstall_app("bible-multi-the-son-of-man", BibleSOMProgressBar, LaunchBibleSOMButton, InstallBibleSOMButton, UninstallBibleSOMButton, True)

End

Public Sub LaunchPresenterButton_Click()

  launch_app("launch-presenter.sh")

End

Public Sub InstallPresenterButton_Click()

  install_app("presenter-by-worship-tools", PresenterProgressBar, LaunchPresenterButton, InstallPresenterButton, UninstallPresenterButton)

End

Public Sub UninstallPresenterButton_Click()

  uninstall_app("presenter-by-worship-tools", PresenterProgressBar, LaunchPresenterButton, InstallPresenterButton, UninstallPresenterButton)

End

Public Sub LaunchFreeShowButton_Click()

  launch_app("freeshow")

End

Public Sub InstallFreeShowButton_Click()

  install_app("freeshow", FreeShowProgressBar, LaunchFreeShowButton, InstallFreeShowButton, UninstallFreeShowButton)

End

Public Sub UninstallFreeShowButton_Click()

  uninstall_app("freeshow", FreeShowProgressBar, LaunchFreeShowButton, InstallFreeShowButton, UninstallFreeShowButton)

End

Public Sub LaunchFloodlightButton_Click()

  launch_app("io.gitlab.floodlight.Presenter", False, True)

End

Public Sub InstallFloodlightButton_Click()

  install_app("io.gitlab.floodlight.Presenter", FloodightProgressBar, LaunchFloodlightButton, InstallFloodlightButton, UninstallFloodlightButton, False, True)

End

Public Sub UninstallFloodlightButton_Click()

  uninstall_app("io.gitlab.floodlight.Presenter", FloodightProgressBar, LaunchFloodlightButton, InstallFloodlightButton, UninstallFloodlightButton, False, True)

End

Public Sub LaunchQueleaButton_Click()

  launch_app("quelea")

End

Public Sub InstallQueleaButton_Click()

  install_app("quelea", QueleaProgressBar, LaunchQueleaButton, InstallQueleaButton, UninstallQueleaButton, True)

End

Public Sub UninstallQueleaButton_Click()

  uninstall_app("quelea", QueleaProgressBar, LaunchQueleaButton, InstallQueleaButton, UninstallQueleaButton, True)

End

Public Sub LaunchAccountable2youButton_Click()

  launch_app("accountable2you")

End

Public Sub InstallAccountable2youButton_Click()

  install_app("accountable2you", Accountable2youProgressBar, LaunchAccountable2youButton, InstallAccountable2youButton, UninstallAccountable2youButton, True)

End

Public Sub UninstallAccountable2youButton_Click()

  uninstall_app("accountable2you", Accountable2youProgressBar, LaunchAccountable2youButton, InstallAccountable2youButton, UninstallAccountable2youButton, True)

End

Public Sub ExitButton_Click()

  Quit

End

Public Sub TerminalToggle_Click()

  If TerminalToggle.Value = 0 Then
    TerminalView.Hide
    TerminalView.H = 0
    TerminalToggle.Text = "Show Details"
  Else 
    TerminalView.Show
    TerminalView.H = 448
    TerminalToggle.Text = "Hide Details"
  Endif

End
